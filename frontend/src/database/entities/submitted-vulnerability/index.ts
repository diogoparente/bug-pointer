import prisma from "@/database/client";
import { SubmittedVulnerability } from "@prisma/client";

const getAllSubmittedVulnerabilies = async () => {
  const allSubmittedVulnerabilies = await prisma.submittedVulnerability.findMany();
  return allSubmittedVulnerabilies;
};

const updateSubmittedVulnerability = async (submittedVulnerability: SubmittedVulnerability) => {
  try {
    await prisma.submittedVulnerability.update({
      where: {
        id: submittedVulnerability.id,
      },
      data: {
        ...submittedVulnerability,
      },
    });
  } catch (error) {
    console.log(error);
  }
};

const insertSubmittedVulnerability = async (submittedVulnerability: WithoutId<SubmittedVulnerability>) => {
  let insertedSubmittedVulnerability;
  try {
    insertedSubmittedVulnerability = await prisma.submittedVulnerability.create({
      data: submittedVulnerability,
    });
  } catch (error) {
    console.log(error);
  }

  return insertedSubmittedVulnerability;
};

const getSubmittedVulnerabilitiesByContestAddress = async (contestAddress: string) => {
  const submittedVulnerabilities = await prisma.submittedVulnerability.findMany({
    where: {
      contestAddress,
    },
  });
  return submittedVulnerabilities;
};

export {
  getAllSubmittedVulnerabilies,
  insertSubmittedVulnerability,
  getSubmittedVulnerabilitiesByContestAddress,
  updateSubmittedVulnerability,
};
